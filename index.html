<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inherent Credential Risk Quantifier</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 1200px;
        }
        .input-card {
            background-color: #ffffff;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2p x rgba(0, 0, 0, 0.05);
        }
        .output-card {
            background-color: #eef2ff; /* Light Indigo */
            border-left: 4px solid #4f46e5;
        }
        .risk-gauge-container {
            position: relative;
            height: 20px;
        }
        .risk-gauge {
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, #10b981 0%, #facc15 50%, #ef4444 80%); /* Green to Yellow to Red */
            border-radius: 9999px;
        }
        .pointer {
            position: absolute;
            height: 30px;
            width: 5px;
            background-color: #1f2937;
            top: -5px;
            border-radius: 9999px;
            transform: translateX(-50%);
            transition: left 0.5s ease-out;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        .pointer::after {
            content: '';
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #1f2937;
        }
        .output-box strong {
            font-size: 2.5rem;
            display: block;
        }
        /* Custom styles for Tailwind to ensure consistency */
        input[type="number"], select {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background-color: white;
            appearance: none; /* Removes default dropdown arrow */
        }
        /* Style for the collapsible summary */
        details summary {
            cursor: pointer;
            font-size: 1.125rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: #4f46e5; /* indigo-600 */
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 1rem;
            list-style: none; /* Removes default arrow/marker */
        }
        details summary::-webkit-details-marker {
            display: none;
        }
        details summary::before {
            content: "+";
            font-weight: bold;
            display: inline-block;
            margin-right: 0.5rem;
            transition: transform 0.2s;
        }
        details[open] summary::before {
            content: "−";
            transform: rotate(0deg);
        }
    </style>
</head>
<body class="p-8">

    <div class="container mx-auto">
        <header class="mb-10 p-6 bg-white rounded-xl shadow-lg border-t-4 border-indigo-600">
            <h1 class="3xl font-bold text-gray-800">
                Inherent Credential Risk Quantifier 
            </h1>
            <p class="text-lg text-gray-500 mt-1">
                Calculates the financial risk exposure based purely on intelligence from Lunar.
        </header>

        <div class="flex flex-col lg:flex-row gap-8">

            <!-- INPUT PANEL (CTI Report Findings) -->
            <div class="input-card flex-1 p-6 rounded-xl">
                <h2 class="text-2xl font-semibold text-indigo-700 mb-6">
                    Compromised Access <span class="text-base font-normal text-gray-500">(Data from Lunar)</span>
                </h2>
                
                <!-- NEW Input Group: Employee Count -->
                <div class="mb-4">
                    <label for="employee_count" class="block text-sm font-medium text-gray-700 mb-1">
                        1. Total Number of Employees (For Pricing Tier)
                    </label>
                    <input type="number" id="employee_count" value="1500" min="1" oninput="calculateRisk()" class="w-full">
                </div>

                <!-- Input Group: Total Exposed -->
                <div class="mb-4">
                    <label for="total_exposed" class="block text-sm font-medium text-gray-700 mb-1">
                        2. Total Compromised Corporate Emails Found
                    </label>
                    <input type="number" id="total_exposed" value="280" min="0" oninput="calculateRisk()" class="w-full">
                </div>

                <!-- Input Group: Infostealer Count -->
                <div class="mb-4">
                    <label for="infostealer_count" class="block text-sm font-medium text-gray-700 mb-1">
                        3. Count of Infostealer Logs Found (Highest Risk)
                    </label>
                    <input type="number" id="infostealer_count" value="20" min="0" oninput="calculateRisk()" class="w-full">
                </div>
                
                <!-- NEW Input Group: Cookies Count -->
                <div class="mb-4">
                    <label for="cookies_count" class="block text-sm font-medium text-gray-700 mb-1">
                        4. Count of Compromised Session Cookies Found (Extreme Risk)
                    </label>
                    <input type="number" id="cookies_count" value="5" min="0" oninput="calculateRisk()" class="w-full">
                </div>

                <!-- Input Group: Privileged Count -->
                <div class="mb-4">
                    <label for="admin_count" class="block text-sm font-medium text-gray-700 mb-1">
                        5. Count of C-Level/Admin Credentials Found
                    </label>
                    <input type="number" id="admin_count" value="3" min="0" oninput="calculateRisk()" class="w-full">
                </div>

                <!-- Input Group: New Unique Dumps -->
                <div class="mb-4">
                    <label for="new_dumps_count" class="block text-sm font-medium text-gray-700 mb-1">
                        6. Count of New Unique Breach Dumps (< 6 mos.)
                    </label>
                    <input type="number" id="new_dumps_count" value="15" min="0" oninput="calculateRisk()" class="w-full">
                </div>

                <!-- Input Group: Industry Select (Replaces impact_cost number input) -->
                <div class="mt-8 pt-4 border-t border-gray-200">
                    <label for="industry_select" class="block text-sm font-medium text-gray-700 mb-1">
                        7. Client Industry (Sets Financial Cost Benchmark)
                    </label>
                    <select id="industry_select" onchange="calculateRisk()" class="w-full">
                        <option value="finance">Financial Services ($6.2M SLE)</option>
                        <option value="healthcare">Healthcare ($5.5M SLE)</option>
                        <option value="tech">Technology ($4.8M SLE)</option>
                        <option value="default" selected>General/Other ($4.5M SLE)</option>
                        <option value="manufacturing">Manufacturing ($4.2M SLE)</option>
                        <option value="retail">Retail ($3.5M SLE)</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">
                        (SLE benchmark adjusted per industry, based on IBM/Ponemon.)
                    </p>
                </div>
            </div>

            <!-- OUTPUT PANEL -->
            <div class="output-panel flex-1 rounded-xl p-6 output-card">
                <h2 class="text-2xl font-semibold text-indigo-700 mb-6">
                    Quantified Inherent Risk Results
                </h2>

                <!-- Priority Alert -->
                <div id="priority_alert" class="priority-alert p-4 rounded-lg mb-6">
                    RISK PRIORITY: HIGH (Likelihood > 5%)
                </div>

                <!-- Peer Comparison Metric -->
                <div class="mb-6 p-3 bg-indigo-100 rounded-lg">
                    <p class="text-md font-medium text-indigo-700">Industry Peer Comparison</p>
                    <p class="text-sm text-gray-700 mt-1" id="peer_comparison_output">
                        Your Inherent Likelihood (0.00%) is X% higher than the industry average (3.50%).
                    </p>
                </div>

                <!-- Risk Gauge Visualization -->
                <div class="mb-8">
                    <label class="block text-lg font-medium text-gray-800 mb-3">
                        Annual Inherent Breach Likelihood
                    </label>
                    <div class="risk-gauge-container">
                        <div class="risk-gauge"></div>
                        <div class="pointer" id="likelihood_pointer"></div>
                    </div>
                    <p class="text-center text-3xl font-bold mt-4 text-indigo-700">
                        <span id="likelihood_output">0.00%</span>
                    </p>
                    <p class="text-sm text-gray-600 text-center mt-1">
                        (Probability of a credential-based breach in the next 12 months given external exposure.)
                    </p>
                </div>

                <!-- Financial Metrics -->
                <div class="grid grid-cols-1 gap-6">

                    <!-- ALE OUTPUT -->
                    <div class="output-box bg-white p-6 rounded-lg shadow-md">
                        <p class="text-lg font-medium text-gray-600">1. Annualized Loss Expectancy (ALE)</p>
                        <strong id="ale_output" class="text-red-600">$0</strong>
                        <p class="text-sm text-gray-500">
                            The expected average dollar loss per year from this specific risk vector.
                        </p>
                    </div>

                    <!-- NET ROI OUTPUT -->
                    <div class="output-box bg-green-50 p-6 rounded-lg shadow-md border-2 border-green-400">
                        <p class="text-lg font-medium text-gray-800">2. Net Risk Reduction ROI (Post-Service Cost)</p>
                        <strong id="roi_output" class="text-green-700">$0</strong>
                        <p class="text-sm text-gray-500">
                            The net financial benefit after factoring in the <span id="roi_cost_output"></span> annual cost of Lunar (based on your employee count).
                        </p>
                    </div>

                </div>
            </div>

        </div>

        <!-- MODEL TRANSPARENCY SECTION (Full Width, Below the Fold) -->
        <div id="model-explanation-section" class="mt-8 p-6 bg-white rounded-xl shadow-lg">
            <h3 class="text-2xl font-semibold text-indigo-700 mb-6">
                Model Transparency: Financial Value of Each Threat
            </h3>
            
            <details class="border border-gray-200 rounded-lg p-4 mb-6">
                <summary>View Full Methodology & Financial Sourcing</summary>
                <div>
                    <p class="text-base text-gray-700 mt-4 mb-6">
                        The financial figures above are calculated by assigning a weighted risk value to <strong>every single compromised credential</strong> found, based on the fidelity and exploitability of the data source.
                    </p>
                    
                    <!-- EXPLANATION OF CRQ PRINCIPLES -->
                    <p class="text-base text-gray-700 mb-6">
                        A credential is assigned a dollar value through a process called <strong>Cyber Risk Quantification (CRQ)</strong>, a method adopted from finance to measure risk in monetary terms. We base our weighting on established industry standards like FAIR (Factor Analysis of Information Risk) and CVSS (Common Vulnerability Scoring System), which prioritize two key factors: 
                        <br><br>
                        1. <span style="font-weight: 600;">Exploitability:</span> How easily can an attacker use the compromised data? Threats that bypass modern security (like session cookies bypassing MFA) are weighted highest.
                        <br>
                        2. <span style="font-weight: 600;">Impact:</span> What is the potential damage if the credential is used? Privileged accounts (C-Level/Admin) are weighted far higher because a compromise means a catastrophic loss.
                        <br><br>
                        This proprietary, quantified risk is then combined with the client's industry-specific financial cost baseline of <span id="dynamic_sle_value"></span> to provide the final figure for your expected annual loss.
                    </p>

                    <div class="text-base text-gray-700 space-y-4 mb-6 ml-6">
                        <p>
                            <span style="font-weight: 700;">Source of Baseline Cost:</span> The Estimated Financial Cost of a Single Breach used in this calculation is the precise industry-specific average, derived from the latest **IBM Security Cost of a Data Breach Report**. This value is currently set to <span id="dynamic_sle_value_2"></span> based on the client's selected industry (e.g., Healthcare costs are highest, Retail is lowest) and represents the average total cost of a data breach, including expenses such as: legal/regulatory fees, customer churn, incident response costs, and lost business revenue. We use this external, vetted figure to ensure the Annualized Loss Expectancy (ALE) is grounded in proven financial reality.
                        </p>
                        <p>
                            <span style="font-weight: 700;">Source of Likelihood Baseline:</span> The Industry Likelihood Baseline used for the Peer Comparison (the industry average probability of a breach) is derived from extensive analysis of breach frequency data published in reports like the **Verizon Data Breach Investigations Report (DBIR)**. This ensures the comparison is accurately benchmarked against the client's specific sector.
                        </p>
                        <p>
                            <strong>Factor Analysis of Information Risk (FAIR™):</strong> Our model aligns with FAIR's core component, Loss Event Frequency (LEF). We assign higher weights to fresh, high-fidelity findings (Infostealer, Cookies) because, in FAIR terms, this data dramatically increases the likelihood that a threat actor will successfully exploit the vulnerability (the leaked credential).
                        </p>
                        <p>
                            <strong>CVSS (Common Vulnerability Scoring System) & OWASP Principles:</strong> We use technical scoring principles to prioritize impact. The assignment of a &times;10 Multiplier for Admin/C-Level Credentials is based on the CVSS principle that vulnerabilities leading to the highest impact (Confidentiality, Integrity, Availability) demand the maximum prioritization. The prioritization of session cookies is based on OWASP's emphasis on high exploitability.
                        </p>
                    </div>
                    <!-- END EXPLANATION OF CRQ PRINCIPLES -->

                    <p class="text-base text-gray-700 mb-6 font-bold">
                        The dollar amounts shown below are normalized meaning we scale the Estimated Financial Cost of a Single Breach down based on the calculated, low probability that this specific credential will successfully lead to a full loss event. This is why the total dollar contribution adds up to your final Annualized Loss Expectancy (ALE).
                    </p>
                </div>
            </details>


            <p class="text-base text-gray-700 mb-6">
                Here is the breakdown of how each threat category contributes to your <strong>Annualized Loss Expectancy (ALE)</strong> of <span id="summary_ale_output"></span>:
            </p>
            <ul class="list-none text-base text-gray-700 space-y-4">
                <li id="explanation_infostealer"></li>
                <li id="explanation_cookies"></li>
                <li id="explanation_admin"></li>
                <li id="explanation_new_dumps"></li>
                <li id="explanation_remainder"></li>
                <li id="explanation_summary"></li>
            </ul>
        </div>
        <!-- END MODEL TRANSPARENCY SECTION -->
    </div>

<script>
    // --- MODEL CONSTANTS (CTI Logic) ---
    const RISK_WEIGHTS = {
        "Infostealer Log": 9,
        "Cookies Found": 10, 
        "New Unique Dump": 7,
        "Combolist": 2, 
        "Privileged Multiplier": 10, 
        "Context Multiplier": 1.5, 
    };

    // --- FINANCIAL CONSTANTS ---
    const NORMALIZATION_FACTOR = 0.00008; 
    const INDUSTRY_TEF_BASELINE = 1.0; 
    
    // Price Book using Mean ACV (Annual Contract Value) based on employee tier
    const PRICE_BOOK_ACV = [
        { maxEmployees: 999, meanACV: 36000 },
        { maxEmployees: 4999, meanACV: 137700 },
        { maxEmployees: 9999, meanACV: 390150 },
        { maxEmployees: Infinity, meanACV: 663255 } 
    ];

    // Industry-specific Single Loss Expectancy (SLE) in dollars (Based on IBM/Ponemon reports)
    const INDUSTRY_SLE_MAP = {
        "finance": 6200000,
        "healthcare": 5500000,
        "tech": 4800000,
        "retail": 3500000,
        "manufacturing": 4200000,
        "default": 4500000
    };
    
    // Industry average likelihood for peer comparison (expressed as a decimal)
    // Dynamic baselines based on industry targeting frequency (Derived from reports like Verizon DBIR)
    const INDUSTRY_LIKELIHOOD_BASELINE_MAP = {
        "finance": 0.048,      // 4.8% 
        "healthcare": 0.052,   // 5.2% 
        "tech": 0.038,         // 3.8%
        "retail": 0.028,       // 2.8% 
        "manufacturing": 0.031, // 3.1%
        "default": 0.035       // 3.5%
    };


    function formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
            maximumFractionDigits: 0,
        }).format(amount);
    }
    
    function calculateServiceCost(employeeCount) {
        if (employeeCount <= 0) return 0;
        
        for (const tier of PRICE_BOOK_ACV) {
            if (employeeCount <= tier.maxEmployees) {
                return tier.meanACV;
            }
        }
        return PRICE_BOOK_ACV[PRICE_BOOK_ACV.length - 1].meanACV;
    }

    function calculateRisk() {
        // 1. Get Inputs
        const employeeCount = parseInt(document.getElementById('employee_count').value) || 0;
        const totalExposed = parseInt(document.getElementById('total_exposed').value) || 0;
        const infostealerCount = parseInt(document.getElementById('infostealer_count').value) || 0;
        const cookiesCount = parseInt(document.getElementById('cookies_count').value) || 0; 
        const adminCount = parseInt(document.getElementById('admin_count').value) || 0;
        const newDumpsCount = parseInt(document.getElementById('new_dumps_count').value) || 0;
        
        // Get Impact Cost (SLE) from the selected industry dropdown
        const industrySelect = document.getElementById('industry_select').value;
        const impactCost = INDUSTRY_SLE_MAP[industrySelect] || INDUSTRY_SLE_MAP['default'];

        // Get dynamic likelihood baseline for peer comparison
        const industryBaselineLikelihood = INDUSTRY_LIKELIHOOD_BASELINE_MAP[industrySelect] || INDUSTRY_LIKELIHOOD_BASELINE_MAP['default'];


        // Calculate dynamic service cost
        const LUNAR_SERVICE_COST = calculateServiceCost(employeeCount);

        // Ensure inputs are non-negative
        if (totalExposed < 0 || infostealerCount < 0 || cookiesCount < 0 || adminCount < 0 || newDumpsCount < 0 || impactCost < 0) return;

        // Calculate the remainder (assumed to be lower-risk Combolist/Old Dumps)
        const highRiskCount = infostealerCount + cookiesCount + newDumpsCount;
        const remainderCount = Math.max(0, totalExposed - highRiskCount);

        // --- Step 2: Calculate Weighted Credential Exposure Risk (CER) Score ---

        // 1. Volume & Source Weighting
        let cerScore = 0;
        cerScore += infostealerCount * RISK_WEIGHTS["Infostealer Log"];
        cerScore += cookiesCount * RISK_WEIGHTS["Cookies Found"]; 
        cerScore += newDumpsCount * RISK_WEIGHTS["New Unique Dump"];
        cerScore += remainderCount * RISK_WEIGHTS["Combolist"];

        // 2. Privilege Multiplier (Multiply Admin Count by the highest risk weight)
        const adminRiskAddition = adminCount * RISK_WEIGHTS["Privileged Multiplier"] * RISK_WEIGHTS["Infostealer Log"];
        cerScore += adminRiskAddition;

        // 3. Context Multiplier 
        const contextMultiplier = (infostealerCount > 0 || adminCount > 0 || cookiesCount > 0) ? RISK_WEIGHTS["Context Multiplier"] : 1;

        const finalCERScore = cerScore * contextMultiplier;

        // --- Step 3: Calculate Annual Breach Likelihood (L) ---
        // LIKELIHOOD IS INDEPENDENT OF IMPACT COST (SLE)
        let annualLikelihood = finalCERScore * NORMALIZATION_FACTOR * INDUSTRY_TEF_BASELINE;
        annualLikelihood = Math.min(0.99, annualLikelihood); 

        // --- Step 4: Calculate Annualized Loss Expectancy (ALE) ---
        const ale = annualLikelihood * impactCost;

        // --- Step 5: Calculate Net Risk Reduction ROI ---
        
        // 5a. Calculate Gross Risk Reduction Value (Avoided Loss)
        // We calculate the loss avoidance by removing the high-risk CER contribution
        const mitigatedCER = (infostealerCount * RISK_WEIGHTS["Infostealer Log"]) + 
                             (cookiesCount * RISK_WEIGHTS["Cookies Found"]) + 
                             (adminCount * RISK_WEIGHTS["Privileged Multiplier"] * RISK_WEIGHTS["Infostealer Log"]) + 
                             (newDumpsCount * RISK_WEIGHTS["New Unique Dump"]);
        
        const residualCER = finalCERScore - mitigatedCER;
        const residualLikelihood = Math.max(0, residualCER * NORMALIZATION_FACTOR * INDUSTRY_TEF_BASELINE);
        const aleAfterMitigation = residualLikelihood * impactCost;

        const grossRiskReductionValue = ale - aleAfterMitigation;

        // 5b. Calculate Net ROI (Gross Reduction - Service Cost)
        const netROI = grossRiskReductionValue - LUNAR_SERVICE_COST;

        // --- 6. Calculate Dollar Weight Contribution for each component ---
        
        // Calculate the individual CER for each component, then apply the full context and financial multipliers
        const getComponentDollarWeight = (count, weight) => {
             const cer = count * weight;
             return cer * NORMALIZATION_FACTOR * INDUSTRY_TEF_BASELINE * impactCost * contextMultiplier;
        };
        
        const infostealerDollarWeight = getComponentDollarWeight(infostealerCount, RISK_WEIGHTS["Infostealer Log"]);
        const cookiesDollarWeight = getComponentDollarWeight(cookiesCount, RISK_WEIGHTS["Cookies Found"]);
        const adminCombinedWeight = RISK_WEIGHTS["Privileged Multiplier"] * RISK_WEIGHTS["Infostealer Log"]; // 10 * 9
        const adminDollarWeight = getComponentDollarWeight(adminCount, adminCombinedWeight);
        const newDumpsDollarWeight = getComponentDollarWeight(newDumpsCount, RISK_WEIGHTS["New Unique Dump"]);
        const remainderDollarWeight = getComponentDollarWeight(remainderCount, RISK_WEIGHTS["Combolist"]);
        
        // --- 7. Display Outputs ---

        // Likelihood Output
        document.getElementById('likelihood_output').textContent = `${(annualLikelihood * 100).toFixed(2)}%`;

        // ALE Output
        document.getElementById('ale_output').textContent = formatCurrency(ale);

        // ROI Output (Display Net ROI)
        document.getElementById('roi_output').textContent = formatCurrency(netROI);
        document.getElementById('roi_output').className = (netROI >= 0) ? "text-green-700" : "text-red-600";

        // Dynamic Service Cost Output
        document.getElementById('roi_cost_output').textContent = formatCurrency(LUNAR_SERVICE_COST);


        // Peer Comparison Output (UPDATED to use dynamic baseline)
        const comparisonDiff = (annualLikelihood * 100) - (industryBaselineLikelihood * 100);
        // Safely extract industry name for display
        const selectElement = document.getElementById('industry_select');
        const selectedOptionText = selectElement.options[selectElement.selectedIndex].text;
        const industryNameMatch = selectedOptionText.match(/([A-Z][a-z]+)/g);
        const industryName = industryNameMatch ? industryNameMatch[0] : 'General';
        
        const comparisonText = (comparisonDiff >= 0) 
            ? `Your Inherent Likelihood (${(annualLikelihood * 100).toFixed(2)}%) is <strong>${comparisonDiff.toFixed(2)}% higher</strong> than the ${industryName} industry average (${(industryBaselineLikelihood * 100).toFixed(2)}%).`
            : `Your Inherent Likelihood (${(annualLikelihood * 100).toFixed(2)}%) is <strong>${Math.abs(comparisonDiff).toFixed(2)}% lower</strong> than the ${industryName} industry average (${(industryBaselineLikelihood * 100).toFixed(2)}%).`;
        document.getElementById('peer_comparison_output').innerHTML = comparisonText;


        // Update Risk Gauge
        let pointerPosition = Math.min(annualLikelihood / 0.15, 1.0);
        document.getElementById('likelihood_pointer').style.left = `${pointerPosition * 100}%`;

        // Update Priority Alert
        updatePriorityAlert(annualLikelihood);
        
        // --- 8. Dynamic Transparency Text Update (Conditional Toning) ---
        
        // Update ALE in the heading text
        document.getElementById('summary_ale_output').textContent = formatCurrency(ale);

        // Update dynamic SLE values in the CRQ narrative
        const formattedImpactCost = formatCurrency(impactCost);
        document.getElementById('dynamic_sle_value').textContent = formattedImpactCost;
        document.getElementById('dynamic_sle_value_2').textContent = formattedImpactCost;


        // Calculate Ratios for Toning
        const totalExposedForRatio = Math.max(totalExposed, 1); 
        const infostealerRatio = infostealerCount / totalExposedForRatio;
        const cookiesRatio = cookiesCount / totalExposedForRatio;
        
        // A. Infostealer Breakout
        if (infostealerCount === 0) {
            document.getElementById('explanation_infostealer').innerHTML = 
                `<strong>1. Infostealer Logs:</strong> We found <strong>zero</strong> Infostealer Logs, confirming no immediate, high-fidelity threat from this source.`;
        } else {
            let tone = "logs found. These are the most exploitable threats";
            let color = "";
            if (infostealerCount >= 20 || infostealerRatio >= 0.08) { 
                 tone = `a <strong>critical concentration</strong> of ${infostealerCount} highly severe logs (representing ${(infostealerRatio * 100).toFixed(1)}% of total exposure). This represents an immediate, escalated threat—the attacker's key to an <strong>initial foothold</strong>`;
                 color = "style='color: #ef4444;'";
            } else if (infostealerCount > 0 && infostealerCount < 5) {
                tone = "a few scattered logs. This is a low volume, manageable threat";
            }
            document.getElementById('explanation_infostealer').innerHTML = 
                `<strong>1. Infostealer Logs:</strong> We found <strong ${color}>${infostealerCount}</strong> ${tone} (fresh session data/credentials) and, by themselves, account for <strong>${formatCurrency(infostealerDollarWeight)}</strong> of your total expected loss.`;
        }

        // B. Cookies Breakout
        if (cookiesCount === 0) {
            document.getElementById('explanation_cookies').innerHTML =
                `<strong>2. Compromised Session Cookies:</strong> We found <strong>zero</strong> Compromised Session Cookies. This is excellent, as there is no immediate threat that could bypass MFA.`;
        } else {
            let tone = "compromised cookies found, which represent extreme, immediate risk";
            let color = "";
            
            if (cookiesCount >= 10) { 
                tone = `a <strong>critical concentration</strong> of ${cookiesCount} compromised cookies (representing ${(cookiesRatio * 100).toFixed(1)}% of total exposure). These are often used to bypass MFA`;
                color = "style='color: #dc2626;'";
            } else if (cookiesCount > 0) {
                 tone = `a <strong>severe number</strong> of ${cookiesCount} compromised cookies. This represents an extreme, immediate risk`;
                 color = "style='color: #dc2626;'";
            }

            document.getElementById('explanation_cookies').innerHTML = 
                `<strong>2. Compromised Session Cookies:</strong> The <strong ${color}>${cookiesCount}</strong> ${tone}, driving <strong>${formatCurrency(cookiesDollarWeight)}</strong> of your total expected loss. This is the <strong>attacker's direct path past your security investment.</strong>`;
        }

        // C. Admin Breakout
        if (adminCount === 0) {
            document.getElementById('explanation_admin').innerHTML =
                `<strong>3. Admin Credentials:</strong> We found <strong>zero</strong> Admin/C-Level Credentials exposed. This eliminates the risk of a catastrophic, privileged compromise from external sources.`;
        } else {
             let tone = "Admin/C-Level Credentials are exposed";
             let adminColor = "";
             let cookieContext = "";
             
             if (adminCount >= 5) {
                tone = "a <strong>highly critical number</strong> of Admin/C-Level Credentials";
                adminColor = "style='color: #b91c1c;'";
             } else { 
                tone = `a <strong>severe exposure</strong> of ${adminCount} highly sensitive Admin/C-Level Credentials`;
                adminColor = "style='color: #ef4444;'"; 
             }
             
             if (cookiesCount > 0) {
                 cookieContext = ` This is compounded by the <strong>${cookiesCount} compromised cookies</strong> also found, which could bypass MFA defenses.`;
             }
            document.getElementById('explanation_admin').innerHTML = 
                `<strong>3. Admin Credentials:</strong> Your <strong ${adminColor}>${adminCount}</strong> ${tone}${cookieContext}. Due to their immense privilege, these high-value targets alone drive <strong>${formatCurrency(adminDollarWeight)}</strong> of your expected annual loss. This represents a <strong>direct loss of system control</strong> if exploited.`;
        }

        // D. New Dumps Breakout
        if (newDumpsCount === 0) {
            document.getElementById('explanation_new_dumps').innerHTML =
                `<strong>4. New Unique Dumps:</strong> We found <strong>zero</strong> New Unique Breach Dumps, meaning no recent, verifiable database compromises are impacting your organization.`;
        } else {
            let tone = "recent breach dumps found";
            if (newDumpsCount >= 50) {
                 tone = "a significant volume of recent breach dumps";
            }
            document.getElementById('explanation_new_dumps').innerHTML = 
                `<strong>4. New Unique Dumps:</strong> The <strong>${newDumpsCount}</strong> ${tone} represent a medium-level threat (high confidence, single source), contributing <strong>${formatCurrency(newDumpsDollarWeight)}</strong> to the total risk.`;
        }

        // E. Remainder/Baseline Breakout
        if (remainderCount === 0) {
            document.getElementById('explanation_remainder').innerHTML =
                `<strong>5. Baseline Exposure:</strong> The remaining credentials beyond the high-risk categories total <strong>zero</strong>, confirming that all found compromise is contained within the categories above.`;
        } else {
             let tone = "The remaining credentials are the total exposed emails minus the four high-risk categories";
             if (remainderCount >= 500) {
                tone = "<span style='font-weight: 600;'>A very large volume</span> of remaining credentials are the total exposed emails minus the four high-risk categories";
             }
            document.getElementById('explanation_remainder').innerHTML = 
                `<strong>5. Baseline Exposure:</strong> ${tone}. They still contribute <strong>${formatCurrency(remainderDollarWeight)}</strong>, proving that even outdated data poses a financial threat via credential stuffing.`;
        }

        // F. Final Summary
        document.getElementById('explanation_summary').innerHTML = 
            `<strong>6. Final Impact:</strong> The total risk is a combined probability of <strong>${(annualLikelihood * 100).toFixed(2)}%</strong>, leading to a <strong>${formatCurrency(ale)}</strong> Annualized Loss Expectancy. Acting on the high-risk items yields a direct ROI of <strong>${formatCurrency(grossRiskReductionValue)}</strong> in avoided loss.`;

    }

    function updatePriorityAlert(likelihood) {
        const alertDiv = document.getElementById('priority_alert');
        let priority, colorClass;

        if (likelihood > 0.10) { // Over 10%
            priority = "CRITICAL (Immediate Executive Briefing Required)";
            colorClass = "bg-red-600 text-white";
        } else if (likelihood > 0.05) { // Over 5%
            priority = "HIGH (Action Required within 48 Hours)";
            colorClass = "bg-yellow-400 text-gray-800";
        } else {
            priority = "MODERATE (Tracked Exposure)";
            colorClass = "bg-indigo-500 text-white";
        }

        alertDiv.className = `p-4 rounded-lg mb-6 text-center font-bold ${colorClass}`;
        alertDiv.textContent = `RISK PRIORITY: ${priority}`;
    }

    // Initialize the calculator on load
    document.addEventListener('DOMContentLoaded', () => {
        calculateRisk();
    });
</script>

</body>
</html>
